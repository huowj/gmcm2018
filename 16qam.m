M = 16;                  
k = log2(M);            
n = 300000;              
numSamplesPerSymbol = 1;  
rng default
dataIn = randi([0 1],n,1);

dataInMatrix = reshape(dataIn,length(dataIn)/k,k);   
dataSymbolsIn = bi2de(dataInMatrix);                 
dataModR = qammod(dataSymbolsIn,M,[11 9 8 10 3 1 0 2 7 5 4 6 15 13 12 14])

fid = fopen('save_data.txt','w');

for ii = 0:0.1:20
    snr = ii
    receivedSignal = awgn(dataModR,snr,'measured');
    dataSymbolsOut = qamdemod(receivedSignal,M,[11 9 8 10 3 1 0 2 7 5 4 6 15 13 12 14]);
    dataOutMatrix = de2bi(dataSymbolsOut,k);
    dataOut = dataOutMatrix(:);

    [numErrors,ber] = biterr(dataIn,dataOut);
    fprintf(fid,'%d,%5.2e \n', ii,ber)
end
fclose(fid);   

M = 8;                     
k = log2(M);               
n = 300000;                  
rng default                 
dataIn = randi([0 1],n,1); 


dataInMatrix = reshape(dataIn,length(dataIn)/k,k);   
dataSymbolsIn = bi2de(dataInMatrix);                 
dataModR = genqammod(dataSymbolsIn,[-1+1j,1+1j,-1-1j,1-1j,-3+0j,3j,-3j,3])

fid = fopen('save_data_8qam.txt','w');

for ii = 0:0.1:20
    snr = ii
    receivedSignal = awgn(dataModR,snr,'measured');
    dataSymbolsOut = genqamdemod(receivedSignal,[-1+1j,1+1j,-1-1j,1-1j,-3+0j,3j,-3j,3])
    dataOutMatrix = de2bi(dataSymbolsOut,k);
    dataOut = dataOutMatrix(:);

    [numErrors,ber] = biterr(dataIn,dataOut);
    fprintf(fid,'%d,%5.2e \n', ii,ber)
end
fclose(fid);  



M = 4;
k = log2(M);
n = 300000;
numSamplesPerSymbol = 1;    

rng default 
dataIn = randi([0 1],n,1);
 
dataInMatrix = reshape(dataIn,length(dataIn)/k,k);
dataSymbolsIn = bi2de(dataInMatrix);                
dataModR = qammod(dataSymbolsIn,M,[3 0 2 1])

fid = fopen('save_data_qpsk.txt','w');

for ii = 0:0.1:20
    snr = ii
    receivedSignal = awgn(dataModR,snr,'measured');
    dataSymbolsOut = qamdemod(receivedSignal,M,[3 0 2 1]);
    dataOutMatrix = de2bi(dataSymbolsOut,k);
    dataOut = dataOutMatrix(:);                 

    [numErrors,ber] = biterr(dataIn,dataOut);
    fprintf(fid,'%d,%5.2e \n', ii,ber)
end
fclose(fid);  

M = 16;
x = (0:15)';
y1 = qammod(x,16,[11 9 8 10 3 1 0 2 7 5 4 6 15 13 12 14]);
scatterplot(y1)
text(real(y1)+0.1, imag(y1), dec2bin(x))
title('16-QAM, Binary Symbol Mapping')
axis([-4 4 -4 4])

% 绘图
x = 0:0.1:20
a = [ 2.87e-01 2.84e-01 2.82e-01 2.80e-01 2.77e-01 2.75e-01 2.73e-01 2.69e-01 2.67e-01 2.66e-01 2.62e-01 2.59e-01 2.57e-01 2.54e-01 2.53e-01 2.49e-01 2.46e-01 2.45e-01 2.41e-01 2.40e-01 2.38e-01 2.36e-01 2.32e-01 2.29e-01 2.27e-01 2.25e-01 2.23e-01 2.19e-01 2.17e-01 2.15e-01 2.12e-01 2.10e-01 2.08e-01 2.06e-01 2.02e-01 2.01e-01 1.97e-01 1.95e-01 1.93e-01 1.91e-01 1.89e-01 1.86e-01 1.82e-01 1.81e-01 1.78e-01 1.75e-01 1.73e-01 1.70e-01 1.70e-01 1.66e-01 1.64e-01 1.61e-01 1.59e-01 1.58e-01 1.55e-01 1.52e-01 1.51e-01 1.47e-01 1.46e-01 1.43e-01 1.40e-01 1.38e-01 1.36e-01 1.35e-01 1.34e-01 1.30e-01 1.28e-01 1.26e-01 1.24e-01 1.21e-01 1.19e-01 1.18e-01 1.15e-01 1.13e-01 1.11e-01 1.09e-01 1.07e-01 1.05e-01 1.02e-01 1.01e-01 9.78e-02 9.65e-02 9.34e-02 9.23e-02 8.97e-02 8.73e-02 8.61e-02 8.41e-02 8.13e-02 8.00e-02 7.77e-02 7.49e-02 7.44e-02 7.15e-02 7.00e-02 6.78e-02 6.61e-02 6.40e-02 6.36e-02 6.10e-02 5.85e-02 5.70e-02 5.54e-02 5.42e-02 5.18e-02 5.07e-02 4.80e-02 4.66e-02 4.51e-02 4.40e-02 4.18e-02 4.06e-02 3.90e-02 3.71e-02 3.62e-02 3.46e-02 3.39e-02 3.21e-02 3.10e-02 2.91e-02 2.80e-02 2.73e-02 2.59e-02 2.47e-02 2.30e-02 2.22e-02 2.10e-02 2.02e-02 1.90e-02 1.79e-02 1.70e-02 1.66e-02 1.55e-02 1.46e-02 1.41e-02 1.28e-02 1.18e-02 1.13e-02 1.06e-02 1.00e-02 9.61e-03 8.43e-03 7.99e-03 7.51e-03 6.90e-03 6.80e-03 6.01e-03 5.69e-03 5.33e-03 5.13e-03 4.63e-03 4.23e-03 3.64e-03 3.58e-03 3.11e-03 2.94e-03 2.56e-03 2.48e-03 2.08e-03 1.91e-03 1.81e-03 1.62e-03 1.41e-03 1.43e-03 1.13e-03 1.05e-03 8.67e-04 8.53e-04 7.13e-04 6.43e-04 6.67e-04 5.13e-04 3.63e-04 4.03e-04 3.90e-04 2.93e-04 2.53e-04 2.13e-04 2.07e-04 1.47e-04 1.13e-04 1.03e-04 1.17e-04 1.37e-04 8.00e-05 9.67e-05 4.33e-05 4.67e-05 4.00e-05 4.33e-05 2.67e-05 2.33e-05 1.00e-05 1.00e-05 1.67e-05 6.67e-06 1.00e-05 1.00e-05 2.33e-05 0.00e+00 3.33e-06]
aa= [3.63e-01 3.61e-01 3.60e-01 3.59e-01 3.55e-01 3.56e-01 3.53e-01 3.50e-01 3.49e-01 3.47e-01 3.44e-01 3.43e-01 3.41e-01 3.40e-01 3.37e-01 3.35e-01 3.32e-01 3.32e-01 3.30e-01 3.26e-01 3.26e-01 3.24e-01 3.19e-01 3.18e-01 3.16e-01 3.16e-01 3.15e-01 3.10e-01 3.09e-01 3.05e-01 3.02e-01 3.01e-01 2.97e-01 2.97e-01 2.93e-01 2.90e-01 2.88e-01 2.86e-01 2.83e-01 2.82e-01 2.80e-01 2.76e-01 2.73e-01 2.73e-01 2.70e-01 2.66e-01 2.64e-01 2.60e-01 2.60e-01 2.56e-01 2.54e-01 2.51e-01 2.48e-01 2.47e-01 2.43e-01 2.39e-01 2.38e-01 2.34e-01 2.35e-01 2.31e-01 2.25e-01 2.24e-01 2.22e-01 2.21e-01 2.17e-01 2.14e-01 2.10e-01 2.07e-01 2.05e-01 2.00e-01 1.98e-01 1.95e-01 1.91e-01 1.89e-01 1.87e-01 1.83e-01 1.80e-01 1.78e-01 1.74e-01 1.71e-01 1.67e-01 1.64e-01 1.61e-01 1.59e-01 1.54e-01 1.52e-01 1.50e-01 1.47e-01 1.42e-01 1.40e-01 1.36e-01 1.32e-01 1.32e-01 1.27e-01 1.25e-01 1.22e-01 1.18e-01 1.13e-01 1.13e-01 1.09e-01 1.06e-01 1.03e-01 1.00e-01 9.71e-02 9.41e-02 9.14e-02 8.83e-02 8.47e-02 8.27e-02 8.06e-02 7.64e-02 7.45e-02 7.14e-02 6.97e-02 6.77e-02 6.36e-02 6.26e-02 5.85e-02 5.77e-02 5.43e-02 5.26e-02 5.11e-02 4.81e-02 4.57e-02 4.31e-02 4.14e-02 3.95e-02 3.80e-02 3.60e-02 3.39e-02 3.21e-02 3.06e-02 2.91e-02 2.75e-02 2.62e-02 2.42e-02 2.27e-02 2.15e-02 2.01e-02 1.90e-02 1.81e-02 1.67e-02 1.53e-02 1.44e-02 1.34e-02 1.28e-02 1.14e-02 1.10e-02 9.89e-03 9.73e-03 8.93e-03 7.91e-03 7.24e-03 6.41e-03 5.78e-03 5.55e-03 5.01e-03 4.97e-03 4.00e-03 3.56e-03 3.53e-03 3.06e-03 2.67e-03 2.69e-03 2.01e-03 2.02e-03 1.60e-03 1.61e-03 1.33e-03 1.38e-03 1.36e-03 1.00e-03 8.27e-04 7.47e-04 6.87e-04 5.27e-04 4.93e-04 3.83e-04 3.23e-04 3.37e-04 2.57e-04 1.63e-04 1.73e-04 2.13e-04 1.93e-04 1.07e-04 9.67e-05 5.33e-05 1.07e-04 7.33e-05 4.00e-05 6.33e-05 3.67e-05 1.67e-05 5.33e-05 1.33e-05 2.00e-05 1.33e-05 2.67e-05 0.00e+00 6.67e-06]
b = [2.64e-01 2.61e-01 2.60e-01 2.56e-01 2.55e-01 2.52e-01 2.49e-01 2.47e-01 2.44e-01 2.43e-01 2.40e-01 2.39e-01 2.35e-01 2.33e-01 2.30e-01 2.28e-01 2.25e-01 2.22e-01 2.20e-01 2.17e-01 2.14e-01 2.12e-01 2.09e-01 2.06e-01 2.05e-01 2.01e-01 1.99e-01 1.96e-01 1.93e-01 1.90e-01 1.88e-01 1.84e-01 1.83e-01 1.79e-01 1.77e-01 1.73e-01 1.72e-01 1.69e-01 1.65e-01 1.64e-01 1.61e-01 1.57e-01 1.55e-01 1.52e-01 1.49e-01 1.46e-01 1.43e-01 1.41e-01 1.39e-01 1.36e-01 1.34e-01 1.31e-01 1.27e-01 1.25e-01 1.23e-01 1.20e-01 1.17e-01 1.16e-01 1.12e-01 1.10e-01 1.06e-01 1.04e-01 1.02e-01 9.87e-02 9.56e-02 9.45e-02 9.14e-02 8.88e-02 8.55e-02 8.41e-02 8.10e-02 7.82e-02 7.70e-02 7.42e-02 7.09e-02 6.93e-02 6.78e-02 6.56e-02 6.31e-02 6.03e-02 5.79e-02 5.62e-02 5.45e-02 5.15e-02 4.98e-02 4.86e-02 4.65e-02 4.45e-02 4.25e-02 4.05e-02 3.89e-02 3.71e-02 3.52e-02 3.42e-02 3.30e-02 3.07e-02 2.91e-02 2.77e-02 2.62e-02 2.53e-02 2.40e-02 2.24e-02 2.06e-02 2.01e-02 1.86e-02 1.76e-02 1.64e-02 1.50e-02 1.47e-02 1.36e-02 1.29e-02 1.16e-02 1.16e-02 1.08e-02 9.42e-03 8.96e-03 8.26e-03 7.87e-03 7.06e-03 6.51e-03 6.03e-03 5.62e-03 5.07e-03 4.76e-03 4.08e-03 3.92e-03 3.79e-03 3.38e-03 2.90e-03 2.56e-03 2.32e-03 2.13e-03 2.03e-03 1.65e-03 1.60e-03 1.45e-03 1.27e-03 9.73e-04 9.47e-04 1.01e-03 7.93e-04 6.97e-04 7.03e-04 5.30e-04 5.00e-04 3.73e-04 3.60e-04 3.07e-04 3.27e-04 2.57e-04 1.83e-04 1.40e-04 1.23e-04 1.43e-04 1.17e-04 1.07e-04 6.67e-05 4.67e-05 4.67e-05 5.67e-05 3.33e-05 3.33e-05 2.33e-05 1.00e-05 3.33e-06 1.00e-05 1.00e-05 6.67e-06 3.33e-06 6.67e-06 0.00e+00 3.33e-06 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00]
c = [ 2.12e-01 2.09e-01 2.06e-01 2.03e-01 2.00e-01 1.95e-01 1.93e-01 1.88e-01 1.85e-01 1.82e-01 1.81e-01 1.75e-01 1.72e-01 1.68e-01 1.65e-01 1.62e-01 1.60e-01 1.57e-01 1.51e-01 1.48e-01 1.45e-01 1.42e-01 1.39e-01 1.34e-01 1.31e-01 1.28e-01 1.26e-01 1.22e-01 1.20e-01 1.15e-01 1.12e-01 1.09e-01 1.07e-01 1.03e-01 9.92e-02 9.61e-02 9.34e-02 8.91e-02 8.82e-02 8.48e-02 8.16e-02 7.87e-02 7.55e-02 7.34e-02 7.00e-02 6.78e-02 6.52e-02 6.15e-02 5.91e-02 5.77e-02 5.47e-02 5.22e-02 5.02e-02 4.81e-02 4.58e-02 4.33e-02 4.13e-02 4.01e-02 3.80e-02 3.58e-02 3.43e-02 3.19e-02 3.04e-02 2.91e-02 2.71e-02 2.67e-02 2.45e-02 2.25e-02 2.16e-02 2.00e-02 1.84e-02 1.72e-02 1.63e-02 1.54e-02 1.47e-02 1.38e-02 1.25e-02 1.16e-02 1.04e-02 1.00e-02 9.26e-03 8.43e-03 7.43e-03 6.97e-03 6.32e-03 5.93e-03 5.29e-03 4.85e-03 4.30e-03 4.15e-03 3.35e-03 3.35e-03 2.98e-03 2.88e-03 2.52e-03 2.18e-03 1.83e-03 1.73e-03 1.54e-03 1.38e-03 1.31e-03 1.04e-03 9.07e-04 8.10e-04 8.30e-04 5.30e-04 6.07e-04 5.30e-04 3.53e-04 3.50e-04 3.83e-04 2.47e-04 2.77e-04 1.70e-04 1.37e-04 9.00e-05 1.83e-04 1.03e-04 7.00e-05 7.00e-05 6.00e-05 2.67e-05 4.00e-05 2.67e-05 6.67e-06 1.67e-05 1.33e-05 1.00e-05 0.00e+00 3.33e-06 6.67e-06 0.00e+00 1.33e-05 0.00e+00 0.00e+00 1.33e-05 6.67e-06 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00 0.00e+00]

plot(x,a,'-', x, aa, '-r', x,b,'*', x, c, 'o'); %折线绘图
